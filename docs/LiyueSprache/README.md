# Mindustry-C：将 C 代码编译为 Mindustry 逻辑处理器指令

## 什么是 Mindustry-C？

请注意：Mindustry-C 使用了一些 DeepSeek 生成的代码。

Mindustry-C 将 C 代码编译为 Mindustry 逻辑——因为后者太烧脑。

有一些编译器能够将 C/C++/Python 转换为逻辑，但它们不好用。所以我们有了这个编译器。

## 安装

Mindustry-C 不需要安装。你只需要下载 `main.html` 和所有 JavaScript 文件，然后在同一目录下启动一个 HTTP 服务器（这一步是必要的，否则脚本会被 CORS 策略阻止）。

用较新的浏览器（至少支持 ES6）访问 `main.html` 即可。

建议保持网络连接，因为 `main.html` 中使用了来自 CDN 的 Bootstrap 以实现界面。

## Mindustry-C 特性

- 大部分 C89 特性
    - 结构体，联合体（未测试），`typedef`（注意：不支持匿名结构体）
    - 但没有 `#` 开头的预处理器指令
    - 函数指针的支持有限

- `const` 和 `auto` 的部分支持（`auto` 用于声明和处理器直接连接的建筑）
- 内存布局（在编译器中指定）
- Mindustry 的”系统调用“
- 插入”汇编“（`asm`）
- 部分编译器优化
    - 运行时常量计算
    - 移除未使用的变量
    - 内联函数（功能有限）
    - **不支持循环展开（因为有代码行数限制）**

## 注意

以下功能需要至少一个内存元：

- `volatile` 变量
- 被取地址的变量
- 结构体/联合体
- 数组（如果你想要在无内存元的情况下实现数组，考虑阅读文档中关于伪列表（pseudo list）的相关内容）
- 递归函数（**注意：使用递归函数将造成较大开销并可能不稳定。不建议这么做。**）

一个指针占用两个单位的空间。

## 特殊语法

### Mindustry 相关

- `device` 用于描述建筑/单位，`content_t` 用于描述物品。
- 声明连接到处理器的建筑：`auto device converyor1;`（`auto` 是必须的）
- 对于 `ulocate`，使用 `(volatile int*)` 转换变量为”引用“。
- 函数指针必须使用 `typedef` 定义相应类型后再使用。

### 编译器特性

initializer_list（如 `{1,2,3}`）**不能**为空，否则将导致编译器崩溃！
